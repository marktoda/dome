{
  "name": "GitHub Ingestor Monitoring Dashboard",
  "description": "Monitoring dashboard for the GitHub Ingestor service",
  "variables": {
    "environment": {
      "default": "production",
      "description": "Environment to monitor",
      "values": ["production", "staging", "development"]
    },
    "timeRange": {
      "default": "1h",
      "description": "Time range for metrics",
      "values": ["15m", "30m", "1h", "3h", "6h", "12h", "24h", "7d"]
    }
  },
  "panels": [
    {
      "title": "Service Health",
      "type": "status",
      "metrics": [
        {
          "name": "github_ingestor.health.status",
          "aggregation": "avg",
          "filter": "environment=$environment"
        }
      ],
      "thresholds": {
        "critical": 0,
        "warning": 1,
        "ok": 2
      },
      "description": "Overall service health status (0=error, 1=warning, 2=ok)"
    },
    {
      "title": "HTTP Request Rate",
      "type": "timeseries",
      "metrics": [
        {
          "name": "github_ingestor.api.request",
          "aggregation": "sum",
          "filter": "environment=$environment",
          "groupBy": ["path", "method"]
        }
      ],
      "unit": "requests/min",
      "description": "HTTP request rate by path and method"
    },
    {
      "title": "HTTP Error Rate",
      "type": "timeseries",
      "metrics": [
        {
          "name": "github_ingestor.api.error",
          "aggregation": "sum",
          "filter": "environment=$environment",
          "groupBy": ["path", "status_category"]
        }
      ],
      "unit": "errors/min",
      "description": "HTTP error rate by path and status code category"
    },
    {
      "title": "API Latency",
      "type": "heatmap",
      "metrics": [
        {
          "name": "github_ingestor.api.request_duration_ms",
          "aggregation": "p95",
          "filter": "environment=$environment",
          "groupBy": ["path"]
        }
      ],
      "unit": "ms",
      "description": "API request latency (p95) by path"
    },
    {
      "title": "Webhook Processing",
      "type": "timeseries",
      "metrics": [
        {
          "name": "github_ingestor.webhook.received",
          "aggregation": "sum",
          "filter": "environment=$environment",
          "groupBy": ["event"]
        },
        {
          "name": "github_ingestor.webhook.error",
          "aggregation": "sum",
          "filter": "environment=$environment",
          "groupBy": ["event"]
        }
      ],
      "unit": "events/min",
      "description": "Webhook events received and errors by event type"
    },
    {
      "title": "Webhook Processing Time",
      "type": "timeseries",
      "metrics": [
        {
          "name": "github_ingestor.webhook.processing_ms",
          "aggregation": "p95",
          "filter": "environment=$environment",
          "groupBy": ["event"]
        }
      ],
      "unit": "ms",
      "description": "Webhook processing time (p95) by event type"
    },
    {
      "title": "Queue Depth",
      "type": "timeseries",
      "metrics": [
        {
          "name": "github_ingestor.queue.messages_processed",
          "aggregation": "sum",
          "filter": "environment=$environment",
          "groupBy": ["queue"]
        },
        {
          "name": "github_ingestor.queue.messages_failed",
          "aggregation": "sum",
          "filter": "environment=$environment",
          "groupBy": ["queue"]
        }
      ],
      "unit": "messages",
      "description": "Queue messages processed and failed"
    },
    {
      "title": "Queue Processing Time",
      "type": "timeseries",
      "metrics": [
        {
          "name": "github_ingestor.queue.batch_processing_ms",
          "aggregation": "p95",
          "filter": "environment=$environment",
          "groupBy": ["queue"]
        }
      ],
      "unit": "ms",
      "description": "Queue batch processing time (p95)"
    },
    {
      "title": "Queue Success Rate",
      "type": "gauge",
      "metrics": [
        {
          "name": "github_ingestor.queue.success_rate",
          "aggregation": "avg",
          "filter": "environment=$environment",
          "groupBy": ["queue"]
        }
      ],
      "unit": "%",
      "min": 0,
      "max": 100,
      "thresholds": {
        "critical": 90,
        "warning": 95,
        "ok": 99
      },
      "description": "Queue processing success rate"
    },
    {
      "title": "Repository Sync",
      "type": "timeseries",
      "metrics": [
        {
          "name": "github_ingestor.repository.files_processed",
          "aggregation": "sum",
          "filter": "environment=$environment"
        }
      ],
      "unit": "files/min",
      "description": "Repository files processed"
    },
    {
      "title": "Repository Sync Time",
      "type": "timeseries",
      "metrics": [
        {
          "name": "github_ingestor.repository.processing_time_ms",
          "aggregation": "p95",
          "filter": "environment=$environment",
          "groupBy": ["owner"]
        }
      ],
      "unit": "ms",
      "description": "Repository processing time (p95) by owner"
    },
    {
      "title": "GitHub API Rate Limit",
      "type": "timeseries",
      "metrics": [
        {
          "name": "github_ingestor.github_api.rate_limit.remaining",
          "aggregation": "min",
          "filter": "environment=$environment",
          "groupBy": ["scope"]
        },
        {
          "name": "github_ingestor.github_api.rate_limit.limit",
          "aggregation": "max",
          "filter": "environment=$environment",
          "groupBy": ["scope"]
        }
      ],
      "unit": "requests",
      "description": "GitHub API rate limit remaining and total by scope"
    },
    {
      "title": "GitHub API Rate Limit Usage",
      "type": "gauge",
      "metrics": [
        {
          "name": "github_ingestor.github_api.rate_limit.usage_percent",
          "aggregation": "max",
          "filter": "environment=$environment",
          "groupBy": ["scope"]
        }
      ],
      "unit": "%",
      "min": 0,
      "max": 100,
      "thresholds": {
        "critical": 90,
        "warning": 75,
        "ok": 50
      },
      "description": "GitHub API rate limit usage percentage by scope"
    },
    {
      "title": "Cron Execution",
      "type": "timeseries",
      "metrics": [
        {
          "name": "github_ingestor.cron.triggered",
          "aggregation": "sum",
          "filter": "environment=$environment"
        },
        {
          "name": "github_ingestor.cron.error",
          "aggregation": "sum",
          "filter": "environment=$environment"
        }
      ],
      "unit": "executions",
      "description": "Cron job executions and errors"
    }
  ],
  "alerts": [
    {
      "name": "High Error Rate",
      "description": "HTTP error rate is above threshold",
      "metric": "github_ingestor.api.error",
      "aggregation": "sum",
      "filter": "environment=production",
      "threshold": 10,
      "duration": "5m",
      "severity": "critical"
    },
    {
      "name": "API Latency High",
      "description": "API latency is above threshold",
      "metric": "github_ingestor.api.request_duration_ms",
      "aggregation": "p95",
      "filter": "environment=production",
      "threshold": 5000,
      "duration": "5m",
      "severity": "warning"
    },
    {
      "name": "Queue Processing Failures",
      "description": "Queue processing failure rate is above threshold",
      "metric": "github_ingestor.queue.success_rate",
      "aggregation": "avg",
      "filter": "environment=production",
      "threshold": 90,
      "operator": "<",
      "duration": "5m",
      "severity": "critical"
    },
    {
      "name": "GitHub API Rate Limit Critical",
      "description": "GitHub API rate limit usage is critical",
      "metric": "github_ingestor.github_api.rate_limit.usage_percent",
      "aggregation": "max",
      "filter": "environment=production",
      "threshold": 90,
      "duration": "5m",
      "severity": "critical"
    },
    {
      "name": "Cron Job Failures",
      "description": "Cron job failures detected",
      "metric": "github_ingestor.cron.error",
      "aggregation": "sum",
      "filter": "environment=production",
      "threshold": 1,
      "duration": "15m",
      "severity": "warning"
    },
    {
      "name": "Service Health Critical",
      "description": "Service health check is failing",
      "metric": "github_ingestor.health.status",
      "aggregation": "min",
      "filter": "environment=production",
      "threshold": 1,
      "operator": "<",
      "duration": "5m",
      "severity": "critical"
    }
  ]
}